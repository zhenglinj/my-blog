<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="zhenglj" />
    <title>Git笔记</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <link href="/feed/" rel="alternate" title="zhenglj" type="application/atom+xml" />
    <link rel="stylesheet" href="/media/css/style.css" />
    <link rel="stylesheet" href="/media/css/pygments/emacs.css" />
    <!--
		<link rel="stylesheet" href="/media/css/highlight.css" />
		-->
    <script type="text/javascript" src="/media/js/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="/media/js/outliner.js"></script>

    <!-- MathJax for LaTeX -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
      TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
      tex2jax: {
      inlineMath: [ ['$','$'], ['$$$','$$$'], ["\\(","\\)"] ],
      processEscapes: true
      }
      });
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <!-- google-code-prettify -->
	<script type="text/javascript" src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?autoload=true&amp;skin=desert&amp;lang=css" defer="defer"></script>
	<!-- <script type="text/javascript" src="/google-code-prettify/run_prettify.js?autoload=true&amp;skin=desert&amp;lang=css" defer="defer"></script> -->

  </head>
  <!--  <body>
	-->
  <script type="text/javascript">
    function setTimeSpan(){
    var date = new Date();
    timeSpan.innerText=date.format('yyyy-MM-dd hh:mm:ss');
    }

    Date.prototype.format = function(format)
    {
    var o =
    {
    "M+" : this.getMonth()+1, //month
    "d+" : this.getDate(),    //day
    "h+" : this.getHours(),   //hour
    "m+" : this.getMinutes(), //minute
    "s+" : this.getSeconds(), //second
    "q+" : Math.floor((this.getMonth()+3)/3),  //quarter
    "S" : this.getMilliseconds() //millisecond
    }
    if(/(y+)/.test(format))
    format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4 - RegExp.$1.length));
    for(var k in o)
    if(new RegExp("("+ k +")").test(format))
    format = format.replace(RegExp.$1,RegExp.$1.length==1 ? o[k] : ("00"+ o[k]).substr((""+ o[k]).length));
    return format;
    }
  </script>
  <body onLoad="setInterval(setTimeSpan,1000);">
    <div id="container">
      <div id="main" role="main">
        <header>
          <h1>Git笔记</h1>
        </header>
        <nav id="real_nav">
          <span><a title="home" class="" href="/">home</a></span>
          <span><a title="categories" class="" href="/categories/">categories</a></span>
          <span><a title="tags" class="" href="/tags/">tags</a></span>
          <!-- <span><a title="logs" class="" href="/logs/">Log</a></span> -->
          <span><a title="about" class="" href="/about/">about</a></span>
          <span><a title="subscribe by RSS" class="" href="/feed/">Subscribe</a></span>
          <!--
			  <span><a title="sports" class="" href="/sports/">Sport</a></span>
			  <span><a title="game" class="" href="/game/">Game</a></span>
			  <span><a title="guestbook" class="" href="/guestbook/">guestbook</a></span>
			  <span><a title="友情链接" class="" href="/links/">链接</a></span>
			  <span><a title="种子订阅" class="" href="/feed/" target="_blank">订阅</a></span>
			  -->
        </nav>
        <article class="content">
          <section class="meta">
<span class="time">
  <time datetime="2013-12-29">2013-12-29</time>
</span>

 | 
<span class="categories">
  categories
  
  <a href="/categories/#technology" title="technology">technology</a>&nbsp;
  
</span>


 | 
<span class="tags">
  tags
  
  <a href="/tags/#git" title="git">git</a>&nbsp;
  
  <a href="/tags/#notes" title="notes">notes</a>&nbsp;
  
</span>

</section>
<section class="post">

<p>Git用法的简明介绍，以及在用Git过程遇到的问题和解决方法，会不断更新。</p>

<hr />

<h2 id="section">官方资料</h2>

<p>一本挺好的在线书籍<a href="http://git-scm.com/book/zh">Pro Git book 中文版</a> </p>

<h2 id="git">Git基础</h2>

<p>工作目录下面的所有文件都不外乎这两种状态：已跟踪或未跟踪。跟踪的文件处于unmodified、modified、staged三种状态周期循环。在编辑过某些文件之后，Git 将这些文件标为已修改。我们逐步把这些修改过的文件放到暂存区域，直到最后一次性提交所有这些暂存起来的文件，如此重复。所以使用 Git 时的文件状态变化周期如下图所示。</p>

<p><img src="/assets/images/git-file-status.png" alt="git-file-status" /> </p>

<h2 id="local">local本地仓库</h2>

<h3 id="configinit">初始化 [config/init]</h3>

<h4 id="section-1">全局变量</h4>

<pre class="prettyprint lang-shell linenums=false">
git config --global user.name "your name"
git config --global user.email "your email"
git config --global color.ui "always"
</pre>

<h4 id="section-2">新版本库</h4>

<pre class="prettyprint lang-shell linenums=false">
git init
</pre>

<h4 id="section-3">设置忽略文件</h4>

<p><strong>这一步骤应该紧跟git init</strong></p>

<ul>
  <li>设置每个人都要忽略的文件，则添加<code>.gitignore</code>文件，在建版本库的目录（根目录）下创建文件<code>.gitignore</code>；</li>
  <li>设置只有自己要忽略的文件，则修改<code>.git/info/exclude</code>文件，可以用正则表达式。</li>
</ul>

<p><code>.gitignore</code> <code>.git/info/exclude</code>文件内容类似，例如：</p>

<pre class="prettyprint lang-shell linenums=false">
# git-ls-files --others --exclude-from=.git/info/exclude
# Lines that start with '#' are comments.
# For a project mostly in C, the following would be a good set of
# exclude patterns (uncomment them if you want to use them):
# *.[oa]
# *~

!.gitignore

*.svn*
*~
*.elc
*.bak
*.tar*
*#
</pre>

<h3 id="section-4">基本操作</h3>

<h4 id="commit">提交 [commit]</h4>

<ul>
  <li>提交所有文件 <code>git commit -a -m "comment"</code>  </li>
  <li>提交单个文件 <code>git commit -m "add readme" readme.txt</code>  </li>
  <li>增加修改提交 <code>git commit -C HEAD -a --amend</code>  </li>
</ul>

<h4 id="checkoutrevert">撤销修改 [checkout/revert]</h4>

<p><strong>撤销未提交的修改</strong></p>

<p><code>git checkout HEAD readme.txt</code> 从HEAD版本检出<br />
<code>git checkout HEAD *.txt</code><br />
<code>git checkout HEAD .</code>  </p>

<p><strong>撤销已提交的修改</strong></p>

<ul>
  <li>反转最近一次提交 <code>git revert --no-commit HEAD</code> 相当于最近一次提交的反操作，恢复到HEAD版本，并且不添加log记录  </li>
  <li>复位到之前的版本 <code>git reset HEAD</code> <code>git reset HEAD [filename]</code> 相当与返回到之前的<br />
<strong>例：</strong>撤销<code>readme.txt</code>到之前某个版本：<br />
<code>git log readme.txt</code> 列出与readme.txt相关的log  </li>
</ul>

<pre class="prettyprint lang-shell linenums=flase">
commit 87b8f684963ebd01247fb623ab9eaad6acde4f92
Author: zhenglinj &lt;zhenglinj@hotmail.com&gt;
Date:   Sun Dec 29 19:33:36 2013 +0800

4th commit

commit 87eac03c968ba2b9abaac3e08969eb47bb0e8c19
Author: zhenglinj &lt;zhenglinj@hotmail.com&gt;
Date:   Sun Dec 29 19:31:55 2013 +0800

third commit
</pre>

<p><code>git reset 87eac03c968ba2b9abaac3e08969eb47bb0e8c19 readme.txt</code> 撤销到之前的版本，不会删除撤销前的版本<br />
  <code>git checkout readme.txt</code> 检出到本地  </p>

<h3 id="section-5">分支操作</h3>

<h4 id="branch">分支基本操作 [branch]</h4>

<ul>
  <li>列出本地所有分支<br />
<code>git branch</code> <code>git branch -a</code>  </li>
  <li>创建分支<br />
<code>git branch &lt;branchname&gt; &lt;commitno&gt;</code><br />
<code>git branch &lt;branchname&gt; [HEAD]</code>  </li>
  <li>检出分支<br />
<code>git checkout &lt;branchname&gt;</code>  </li>
  <li>基于当前分支末梢创建分支并检出<br />
<code>git checkout -b &lt;branchname&gt;</code>  </li>
  <li>
    <p>基于某次提交、分支或标签创建分支<br />
<code>git branch &lt;branchname&gt; &lt;commitno&gt;</code><br />
<code>git branch &lt;branchname2&gt; &lt;branchname&gt;</code><br />
<code>git branch &lt;branchname&gt; &lt;tagname&gt;</code>  </p>
  </li>
  <li>
    <p>删除分支<br />
<code>git branch -d &lt;branchname&gt;</code> 没合并的分支会删除失败<br />
<code>git branch -D &lt;branchname&gt;</code> 没合并的分支也会被删除，强行删除  </p>
  </li>
  <li>重命名分支
<code>git branch -m &lt;branchname&gt; &lt;newname&gt;</code> 不会覆盖已存在的同名分支<br />
<code>git branch -M &lt;branchname&gt; &lt;newname&gt;</code> 会覆盖已存在的同名分支  </li>
</ul>

<h4 id="merge">分支合并 [merge]</h4>

<ul>
  <li>普通合并<br />
合并并提交 <code>git merge &lt;branchname&gt;</code>  如果发生冲突则不自动提交；如果冲突很多，可以<code>git checkout HEAD .</code>撤销<br />
合并不提交 <code>git merge --no-commit &lt;branchname&gt;</code>  </li>
  <li>压合合并<br />
压合并提交 <code>git merge --squash &lt;branchname&gt;</code><br />
压合不提交 <code>git merge --squash --no-commit &lt;branchname&gt;</code>  </li>
  <li>挑选合并  <strong>推荐使用</strong><br />
挑选某次提交合并但不提交 <code>git cherry-pick --no-commit &lt;commitno&gt;</code>  </li>
</ul>

<h4 id="mergetool">解决分支合并的冲突 [mergetool]</h4>

<ul>
  <li>冲突少时，直接编辑冲突文件再提交  </li>
  <li>冲突多复杂时，使用 <code>mergetool</code><br />
使用 <code>mergetool</code> 依次完成：
    <ol>
      <li><code>mergetool</code> 自动生成 <code>.BACKUP</code> <code>.BASE</code> <code>.LOCAL</code> <code>.REMOTE</code> 四个文件</li>
      <li>指定调用冲突解决工具，如 <code>meld</code> <code>kdiff3</code> 等</li>
      <li>解决后删除 <code>.orig</code> 文件</li>
      <li>提交
用<code>meld</code> <code>kdiff3</code> 编辑冲突
<code>git mergetool -t meld</code><br />
<code>git mergetool -t kdiff3</code><br />
具体可以见 <a href="http://www.gitguys.com/topics/merging-with-a-gui/">这里</a> </li>
    </ol>
  </li>
</ul>

<h4 id="stash">储藏 [stash]</h4>

<p><strong>暂存不提交的功能，不适合多用</strong></p>

<p><code>储藏</code>当你做了修改想暂时储藏，但有不想commit时，可以用<code>git stash [save]</code>。<br />
<strong>不提倡使用<code>git stash</code></strong>，因为没有commit很容易忘记。<code>git stash</code>以后要及时挑选合并（cherry-pick）。  </p>

<ul>
  <li><code>git stash [save]</code> 将当前的工作区内容暂时<code>储藏</code>到Git栈中。从最近的一次提交HEAD中读取相关内容，让工作区保证和上次提交的内容一致。  </li>
  <li><code>git stash list</code>   显示Git栈内的所有备份，可以利用这个列表来决定从那个地方恢复。<br />
<code>stash@{0}: WIP on master: 95c87fd after merge</code> <code>stash@{1}</code> <code>stash@{2}</code>等。  </li>
  <li><code>git stash pop</code>    从Git栈中读取最近一次<code>储藏</code>的内容，恢复工作区。栈中可能存在多个stash的内容，pop会从最近的一个stash恢复。  </li>
  <li><code>git stash apply stash@{n}</code> 从Git栈中读取<code>stash@{n}</code>，例如：<code>stash@{0}</code> <code>stash@{1}</code> <code>stash@{2}</code>等。  </li>
  <li><code>git stash clear</code>  清空Git栈。此时使用gitk等图形化工具会发现，原来stash的哪些节点都消失了。  </li>
</ul>

<h3 id="tag">标签 [tag]</h3>

<ol>
  <li>创建标签<br />
<code>git tag 1.0</code> 为当前分支最近一次提交创建标签 <strong>标签无法重命名</strong><br />
<code>git tag &lt;tagname&gt; &lt;branchname&gt;</code> 为某分支创建标签 <br />
<code>git tag 1.1 &lt;commitno&gt;</code> 为某次提交创建标签  </li>
  <li>显示标签<br />
<code>git tag</code>  </li>
  <li>检出标签<br />
<code>git checkout 1.0</code> 查看标签断面很方便，但不能提交  </li>
  <li>由标签创建分支<br />
<code>git branch &lt;branchname&gt; &lt;tagname&gt;</code><br />
<code>git checkout -b &lt;branchname&gt; &lt;tagname&gt;</code>  </li>
  <li>删除标签<br />
<code>git tag -d 1.0</code></li>
</ol>

<h3 id="loggitk">查看状态 [log/gitk]</h3>

<ol>
  <li>当前状态
<code>git status</code></li>
  <li>历史状态
<code>git log</code>  查看分支历史记录
<code>gitk [&lt;branchname&gt;]</code>
<code>gitk --all</code> 查看所有分支</li>
  <li>每个分支最后的提交
<code>git branch -v</code></li>
</ol>

<h3 id="archive">导出版本库 [archive]</h3>

<p><code>git archive --format=zip HEAD&gt;projectname.zip</code>
<code>git archive --format=zip --prefix=tag1.0/ HEAD&gt;projectname.zip</code></p>

<h2 id="remote">remote远程仓库</h2>

<h3 id="section-6">初始化</h3>

<h4 id="section-7">创建本地库</h4>

<p>可以在移动存储设备上创建仓库，从而实现不同主机代码同步<br />
<code>git init --bare --share</code>  创建了一个公共的仓库，bare库  </p>

<h4 id="clone">克隆版本库 [clone]</h4>

<ul>
  <li><code>git clone &lt;url&gt;</code> <br />
<code>git clone h:\gitrep\projectname</code>  </li>
  <li>克隆后自动添加一些config
<code>remote.origin.fetch=+refs/heads/*:refs/remotes/origin/*</code><br />
<code>remote.origin.url=...</code><br />
<code>branch.master.remote=origin</code><br />
<code>branch.master.merge=refs/heads/master</code>  </li>
</ul>

<h4 id="section-8">别名</h4>

<ul>
  <li>添加别名<br />
<code>git remote add &lt;alias&gt; &lt;remote url&gt;</code>  </li>
  <li>添加后自动添加一些config
<code>remote.origin.url=...</code><br />
<code>remote.origin.fetch=+refs/heads/*:refs/remotes/origin/*</code>  </li>
  <li>删除别名<br />
<code>git remote rm &lt;alias&gt;</code> </li>
</ul>

<h3 id="section-9">基本操作</h3>

<h4 id="branch-1">分支 [branch]</h4>

<ul>
  <li>列出远程分支<br />
<code>git branch -r</code>  </li>
  <li>删除远程库中不存在的分支<br />
<code>git remote prune origin</code>  </li>
</ul>

<h4 id="fetchpull">远程库中获取 [fetch/pull]</h4>

<ul>
  <li>获取但不合并<br />
<code>git fetch &lt;remote repo&gt;</code><br />
<code>git fetch origin</code><br />
<code>git fetch &lt;url&gt;</code>  </li>
  <li>获取且合并到当前本地分支<br />
    <ol>
      <li><code>git pull</code>
从默认远程仓库获取，相当于 <code>git pull origin</code><br />
需配置 <code>branch.master.remote=origin</code> <code>branch.master.merge=refs/heads/master</code>，如果使用 <code>git clone</code> 远程库会自动添加以上配置   </li>
      <li><code>git pull h:\gitrep\projectname master</code><br />
不是从默认远程仓库获取，所以要指定获取哪个分支  </li>
    </ol>
  </li>
</ul>

<h4 id="push">推入远程库 [push]</h4>

<p><code>git push origin master</code> 远程库的master不是当前分支</p>

<h3 id="githubcom">github.com</h3>


</section>
<section align="right">
<br/>
<span>
	<a  href="/2013/12/emacs-notes" class="pageNav"  >上一篇</a>
	&nbsp;&nbsp;&nbsp;
	<a  href="/2014/01/hello-world" class="pageNav"  >下一篇</a>
</span>
</section>



  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_shortname = 'zhenglj'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>





<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = 'http://zhenglinj.github.io/2013/12/emacs-notes';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = 'http://zhenglinj.github.io/2014/01/hello-world';
        
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>

        </article>
        <!-- <a style="position:fixed;bottom:5px;right:5px;" href="#" title="Back to Top"> -->
        <!--   <img src="/assets/btt.png" /> -->
        <!-- </a> -->
      </div>

      <footer>
        <p><small>
            <a href="http://github.com/zhenglinj/zhenglinj.github.io/new/master/_posts" target="_blank" title="撰写文章">Po</a>wer<a href="http://github.com/zhenglinj/zhenglinj.github.io/edit/master/_posts/2013-12-29-git-notes.md" target="_blank" title="编辑页面">ed</a> by <a href="http://jekyllrb.com" target="_blank">Jekyll</a> @ <a href="http://github.com/zhenglinj/zhenglinj.github.io" target="_blank" title="项目主页">GitHub</a> | Copyright 2013 - 2014 by <a href="/about/">Zheng Linj</a> | <span class="label label-info" id="timeSpan"></span></small></p>
      </footer>
    </div>
  </body>
</html>
